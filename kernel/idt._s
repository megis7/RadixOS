	.file	"idt.c"
	.comm	idt_entries,2048,32
	.comm	idtr,6,1
	.text
	.globl	idt_init
	.type	idt_init, @function
idt_init:
	pushl	%ebp
	movl	%esp, %ebp
	subl	$24, %esp
	movl	$2048, 8(%esp)
	movl	$0, 4(%esp)
	movl	$idt_entries, (%esp)
	call	memset
	movl	$isr0, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$0, (%esp)
	call	idt_set_gate
	movl	$isr1, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$1, (%esp)
	call	idt_set_gate
	movl	$isr2, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$2, (%esp)
	call	idt_set_gate
	movl	$isr3, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$3, (%esp)
	call	idt_set_gate
	movl	$isr4, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$4, (%esp)
	call	idt_set_gate
	movl	$isr5, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$5, (%esp)
	call	idt_set_gate
	movl	$isr6, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$6, (%esp)
	call	idt_set_gate
	movl	$isr7, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$7, (%esp)
	call	idt_set_gate
	movl	$isr8, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$8, (%esp)
	call	idt_set_gate
	movl	$isr9, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$9, (%esp)
	call	idt_set_gate
	movl	$isr10, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$10, (%esp)
	call	idt_set_gate
	movl	$isr11, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$11, (%esp)
	call	idt_set_gate
	movl	$isr12, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$12, (%esp)
	call	idt_set_gate
	movl	$isr13, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$13, (%esp)
	call	idt_set_gate
	movl	$isr14, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$14, (%esp)
	call	idt_set_gate
	movl	$isr15, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$15, (%esp)
	call	idt_set_gate
	movl	$isr16, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$16, (%esp)
	call	idt_set_gate
	movl	$isr17, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$17, (%esp)
	call	idt_set_gate
	movl	$isr18, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$18, (%esp)
	call	idt_set_gate
	movl	$isr19, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$19, (%esp)
	call	idt_set_gate
	movl	$isr20, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$20, (%esp)
	call	idt_set_gate
	movl	$isr21, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$21, (%esp)
	call	idt_set_gate
	movl	$isr22, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$22, (%esp)
	call	idt_set_gate
	movl	$isr23, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$23, (%esp)
	call	idt_set_gate
	movl	$isr24, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$24, (%esp)
	call	idt_set_gate
	movl	$isr25, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$25, (%esp)
	call	idt_set_gate
	movl	$isr26, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$26, (%esp)
	call	idt_set_gate
	movl	$isr27, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$27, (%esp)
	call	idt_set_gate
	movl	$isr28, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$28, (%esp)
	call	idt_set_gate
	movl	$isr29, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$29, (%esp)
	call	idt_set_gate
	movl	$isr30, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$30, (%esp)
	call	idt_set_gate
	movl	$isr31, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$31, (%esp)
	call	idt_set_gate
	movl	$isr128, %eax
	movl	$238, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$128, (%esp)
	call	idt_set_gate
	movl	$apic_irq0, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$64, (%esp)
	call	idt_set_gate
	movl	$apic_irq1, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$65, (%esp)
	call	idt_set_gate
	movl	$apic_irq2, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$66, (%esp)
	call	idt_set_gate
	movl	$apic_irq3, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$67, (%esp)
	call	idt_set_gate
	movl	$apic_irq4, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$68, (%esp)
	call	idt_set_gate
	movl	$apic_irq5, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$69, (%esp)
	call	idt_set_gate
	movl	$apic_irq6, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$70, (%esp)
	call	idt_set_gate
	movl	$apic_irq7, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$71, (%esp)
	call	idt_set_gate
	movl	$apic_irq8, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$72, (%esp)
	call	idt_set_gate
	movl	$apic_irq9, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$73, (%esp)
	call	idt_set_gate
	movl	$apic_irq10, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$74, (%esp)
	call	idt_set_gate
	movl	$apic_irq11, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$75, (%esp)
	call	idt_set_gate
	movl	$apic_irq12, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$76, (%esp)
	call	idt_set_gate
	movl	$apic_irq13, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$77, (%esp)
	call	idt_set_gate
	movl	$apic_irq14, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$78, (%esp)
	call	idt_set_gate
	movl	$apic_irq15, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$79, (%esp)
	call	idt_set_gate
	movl	$irq0, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$224, (%esp)
	call	idt_set_gate
	movl	$irq1, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$225, (%esp)
	call	idt_set_gate
	movl	$irq2, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$226, (%esp)
	call	idt_set_gate
	movl	$irq3, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$227, (%esp)
	call	idt_set_gate
	movl	$irq4, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$228, (%esp)
	call	idt_set_gate
	movl	$irq5, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$229, (%esp)
	call	idt_set_gate
	movl	$irq6, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$230, (%esp)
	call	idt_set_gate
	movl	$irq7, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$231, (%esp)
	call	idt_set_gate
	movl	$irq8, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$232, (%esp)
	call	idt_set_gate
	movl	$irq9, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$233, (%esp)
	call	idt_set_gate
	movl	$irq10, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$234, (%esp)
	call	idt_set_gate
	movl	$irq11, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$235, (%esp)
	call	idt_set_gate
	movl	$irq12, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$236, (%esp)
	call	idt_set_gate
	movl	$irq13, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$237, (%esp)
	call	idt_set_gate
	movl	$irq14, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$238, (%esp)
	call	idt_set_gate
	movl	$irq15, %eax
	movl	$14, 12(%esp)
	movl	$8, 8(%esp)
	movl	%eax, 4(%esp)
	movl	$239, (%esp)
	call	idt_set_gate
	leave
	ret
	.size	idt_init, .-idt_init
	.globl	idt_set_gate
	.type	idt_set_gate, @function
idt_set_gate:
	pushl	%ebp
	movl	%esp, %ebp
	subl	$12, %esp
	movl	8(%ebp), %ecx
	movl	16(%ebp), %edx
	movl	20(%ebp), %eax
	movb	%cl, -4(%ebp)
	movw	%dx, -8(%ebp)
	movb	%al, -12(%ebp)
	movzbl	-4(%ebp), %eax
	movl	12(%ebp), %edx
	movw	%dx, idt_entries(,%eax,8)
	movzbl	-4(%ebp), %eax
	movl	12(%ebp), %edx
	shrl	$16, %edx
	movw	%dx, idt_entries+6(,%eax,8)
	movzbl	-4(%ebp), %eax
	movzwl	-8(%ebp), %edx
	movw	%dx, idt_entries+2(,%eax,8)
	movzbl	-4(%ebp), %eax
	movb	$0, idt_entries+4(,%eax,8)
	movzbl	-4(%ebp), %eax
	movzbl	-12(%ebp), %edx
	orl	$-128, %edx
	movb	%dl, idt_entries+5(,%eax,8)
	leave
	ret
	.size	idt_set_gate, .-idt_set_gate
	.globl	idtr_install
	.type	idtr_install, @function
idtr_install:
	pushl	%ebp
	movl	%esp, %ebp
	subl	$24, %esp
	movl	$idt_entries, %eax
	movl	%eax, idtr+2
	movw	$2047, idtr
	movl	$idtr, (%esp)
	call	_flushIDT
	leave
	ret
	.size	idtr_install, .-idtr_install
	.section	.rodata
.LC0:
	.string	"isr %h"
	.text
	.globl	isr_handler
	.type	isr_handler, @function
isr_handler:
	pushl	%ebp
	movl	%esp, %ebp
	subl	$24, %esp
	movl	8(%ebp), %eax
	movl	%eax, 4(%esp)
	movl	$.LC0, (%esp)
	call	printfln
	leave
	ret
	.size	isr_handler, .-isr_handler
	.section	.rodata
.LC1:
	.string	"irq %u"
	.text
	.globl	irq_handler
	.type	irq_handler, @function
irq_handler:
	pushl	%ebp
	movl	%esp, %ebp
	subl	$24, %esp
	movl	44(%ebp), %eax
	movl	%eax, 4(%esp)
	movl	$.LC1, (%esp)
	call	printfln
	movl	lapic_base, %eax
	movl	%eax, (%esp)
	call	lapic_send_eoi
	leave
	ret
	.size	irq_handler, .-irq_handler
	.ident	"GCC: (GNU) 4.8.4"
